<div class="min-h-screen relative overflow-hidden bg-gray-900">
  <!-- Background elements -->
  <div class="fixed inset-0 z-0 pointer-events-none">
    <div
      class="absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900"
    ></div>
    <div
      class="absolute inset-0 bg-gradient-to-br from-primary-900/20 via-secondary-900/20 to-accent-900/20 animate-gradient"
    ></div>
    <div
      class="absolute inset-0 bg-gradient-radial from-transparent via-primary-900/10 to-transparent"
    ></div>
    <!-- Animated gradient orbs -->
    <div
      class="absolute top-0 left-0 w-[800px] h-[800px] bg-gradient-to-br from-primary-600/5 to-accent-600/5 rounded-full blur-3xl animate-float-1 -translate-x-1/2 -translate-y-1/2"
    ></div>
    <div
      class="absolute top-1/2 right-0 w-[600px] h-[600px] bg-gradient-to-bl from-secondary-600/5 to-primary-600/5 rounded-full blur-3xl animate-float-2 translate-x-1/2"
    ></div>
    <div
      class="absolute bottom-0 left-1/2 w-[700px] h-[700px] bg-gradient-to-tr from-accent-600/5 to-secondary-600/5 rounded-full blur-3xl animate-float-3 -translate-x-1/2 translate-y-1/2"
    ></div>
  </div>

  <!-- Main Content -->
  <main class="relative z-10">
    <!-- Loading State -->
    <ng-container *ngIf="isLoading">
      <div class="container mx-auto px-4 py-8">
        <!-- Skeleton Profile Header -->
        <div
          class="backdrop-blur-md bg-white/70 rounded-lg shadow-md p-6 mb-8 animate-pulse"
        >
          <div
            class="flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6"
          >
            <!-- Skeleton Profile Photo -->
            <div
              class="w-24 h-24 md:w-32 md:h-32 rounded-full bg-gray-200"
            ></div>
            <!-- Skeleton Info -->
            <div class="flex-1 text-center md:text-left space-y-2">
              <div
                class="h-8 w-48 bg-gradient-to-r from-primary-200 via-secondary-200 to-accent-200 rounded mx-auto md:mx-0 animate-pulse"
              ></div>
              <div class="h-4 w-32 bg-gray-200 rounded mx-auto md:mx-0"></div>
              <div class="h-4 w-24 bg-gray-200 rounded mx-auto md:mx-0"></div>
              <div class="h-4 w-40 bg-gray-200 rounded mx-auto md:mx-0"></div>
            </div>
          </div>
        </div>
        <!-- Skeleton Tabs Layout -->
        <div class="flex flex-col md:flex-row gap-8">
          <!-- Skeleton Vertical Tabs -->
          <nav
            class="md:w-64 flex-shrink-0 space-y-2 flex md:flex-col flex-row overflow-x-auto md:overflow-x-visible"
          >
            <div
              class="h-10 w-32 md:w-full bg-gray-200 rounded-l-lg mb-2"
            ></div>
            <div
              class="h-10 w-32 md:w-full bg-gray-200 rounded-l-lg mb-2"
            ></div>
            <div class="h-10 w-24 md:w-3/4 bg-gray-200 rounded-l-lg mb-2"></div>
          </nav>
          <!-- Skeleton Tab Content -->
          <section
            class="flex-1 backdrop-blur-md bg-white/70 rounded-xl shadow-lg p-6 min-h-[400px] animate-pulse"
          >
            <div class="space-y-4">
              <div
                class="h-8 w-1/2 bg-gradient-to-r from-primary-200 via-secondary-200 to-accent-200 rounded animate-pulse"
              ></div>
              <div class="h-4 w-full bg-gray-200 rounded"></div>
              <div class="h-4 w-5/6 bg-gray-200 rounded"></div>
              <div class="h-4 w-2/3 bg-gray-200 rounded"></div>
              <div class="h-4 w-1/2 bg-gray-200 rounded"></div>
            </div>
          </section>
        </div>
      </div>
    </ng-container>

    <!-- Error State -->
    <div
      *ngIf="error && !isLoading"
      class="flex items-center justify-center min-h-screen"
    >
      <div
        class="bg-white/90 rounded-2xl shadow-2xl p-10 flex flex-col items-center max-w-md mx-auto animate-fadeIn border-t-4 border-red-400"
      >
        <ng-icon
          name="lucideAlertCircle"
          class="w-20 h-20 text-red-400 mb-6 animate-bounce"
          aria-label="Error"
        ></ng-icon>
        <div class="text-red-700 text-2xl font-bold mb-4 text-center">
          {{ "APP.PROFILE-PAGE.ERRORS.PROFILE_LOAD_ERROR" | translate }}
        </div>
        <button
          class="btn btn-primary mt-2 px-8 py-3 text-lg font-bold rounded-xl shadow-lg hover:bg-primary-700 focus:ring-2 focus:ring-primary-400 focus:outline-none transition"
          (click)="reloadPage()"
        >
          {{ "APP.PROFILE-PAGE.ACTIONS.TRY_AGAIN" | translate }}
        </button>
      </div>
    </div>

    <!-- Profile Content -->
    <div
      *ngIf="!isLoading && !error && profileUser"
      class="container mx-auto px-4 py-8"
    >
      <!-- Profile Header -->
      <div class="backdrop-blur-md bg-white/70 rounded-lg shadow-md p-6 mb-8">
        <div
          class="flex flex-col md:flex-row items-center md:items-start space-y-4 md:space-y-0 md:space-x-6"
        >
          <!-- Profile Photo -->
          <div class="relative">
            <img
              [src]="
                localProfilePhotoPreview ||
                profileUser.profilePhoto?.sourceUrl ||
                'assets/placeholder.jpg'
              "
              [alt]="profileUser.fullName"
              class="w-24 h-24 md:w-32 md:h-32 rounded-full object-cover border-4 border-white shadow-lg"
            />
            <div
              *ngIf="profileUser.isVerified"
              class="absolute -bottom-2 -right-2 bg-blue-500 text-white rounded-full p-1"
            >
              <span
                class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 shadow-md border-2 border-white ring-2 ring-primary-300 animate-pulse-slow"
                matTooltip="Verified Account"
              >
                <ng-icon
                  name="lucideCheck"
                  class="w-4 h-4 text-white"
                  aria-label="Verified"
                ></ng-icon>
              </span>
            </div>
          </div>

          <!-- Profile Info -->
          <div class="flex-1 text-center md:text-left">
            <h1 class="text-2xl md:text-3xl font-bold gradient-text mb-2">
              {{ profileUser.fullName }}
            </h1>
            <!-- Location -->
            <div
              *ngIf="profileUser.location"
              class="flex flex-row items-center justify-center md:justify-start text-gray-600 mb-2 gap-2 w-full"
            >
              <ng-icon
                name="lucideMapPin"
                class="w-5 h-5 text-primary-500 flex-shrink-0"
                aria-label="Location"
              ></ng-icon>
              <a
                [href]="getGoogleMapsLink(profileUser.location)"
                target="_blank"
                rel="noopener noreferrer"
                class="underline hover:text-primary-600 transition-colors w-full max-w-xs sm:max-w-full truncate text-center md:text-left"
                aria-label="Open location in Google Maps"
              >
                {{ profileUser.location.address
                }}{{
                  profileUser.location.number
                    ? " " + profileUser.location.number
                    : ""
                }}, {{ profileUser.location.city
                }}{{
                  profileUser.location.zipCode
                    ? " " + profileUser.location.zipCode
                    : ""
                }}
              </a>
            </div>
            <!-- Shelter Badge -->
            <div
              *ngIf="profileUser.roles?.includes(UserRole.Shelter)"
              class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800"
            >
              <ng-icon
                name="lucideBuilding"
                class="w-4 h-4 mr-1"
                aria-label="Shelter"
              ></ng-icon>
              <span>{{ "APP.PROFILE-PAGE.SHELTER.BADGE" | translate }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Tabs Layout -->
      <div class="flex flex-col md:flex-row gap-8">
        <!-- Tabs -->
        <nav class="md:w-64 flex-shrink-0" *ngIf="tabs.length > 0">
          <ul
            class="flex md:flex-col flex-row gap-2 md:gap-3 overflow-x-auto md:overflow-x-visible whitespace-nowrap px-1 sticky top-0 z-20 bg-transparent"
          >
            <li
              *ngFor="let tab of tabs; let i = index"
              class="flex-shrink-0 min-w-[120px] md:min-w-0"
            >
              <button
                class="w-full flex items-center gap-2 px-4 py-3 rounded-lg md:rounded-l-xl md:rounded-t-lg transition-colors duration-200 text-left font-medium text-gray-700 hover:bg-primary-50 focus:outline-none min-w-[120px] md:min-w-0 md:shadow-none md:border-l-4 md:border-transparent"
                [ngClass]="{
                  'bg-gradient-to-r from-primary-100 to-accent-100 text-primary-700 shadow-md border-l-4 border-primary-500 md:shadow-lg md:border-primary-500':
                    selectedTabIndex === i,
                  'bg-white/90 md:bg-white md:border md:border-gray-200 md:shadow-sm':
                    selectedTabIndex !== i
                }"
                (click)="onTabChange(i)"
                [attr.aria-selected]="selectedTabIndex === i"
                [attr.aria-controls]="'profile-tab-' + i"
                [id]="'profile-tab-btn-' + i"
                type="button"
              >
                <ng-icon
                  [name]="tab.icon"
                  class="w-5 h-5"
                  [attr.aria-label]="tab.labelKey | translate"
                ></ng-icon>
                <span class="text-primary-700">{{
                  tab.labelKey | translate
                }}</span>
              </button>
            </li>
          </ul>
        </nav>

        <!-- Tab Content -->
        <section
          *ngIf="tabs.length > 0 && tabs[selectedTabIndex]"
          class="flex-1 backdrop-blur-md bg-white/70 rounded-xl shadow-lg p-6 min-h-[400px] animate-fadeIn"
          [attr.id]="'profile-tab-' + selectedTabIndex"
        >
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-primary-700">
              {{ tabs[selectedTabIndex].labelKey || "" | translate }}
            </h2>
            <!-- Edit Button -->
            <button
              *ngIf="
                tabs[selectedTabIndex]?.component === 'user-info' &&
                isOwnProfile
              "
              (click)="toggleEditMode()"
              [disabled]="isSaving"
              class="flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-300 shadow-md hover:shadow-lg hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-md"
              [ngClass]="{
                'bg-gradient-to-r from-primary-600 to-primary-700 text-white':
                  !isEditMode,
                'bg-gradient-to-r from-gray-600 to-gray-700 text-white':
                  isEditMode
              }"
            >
              <ng-icon
                [name]="isEditMode ? 'lucideX' : 'lucidePencil'"
                class="w-4 h-4"
                [ngClass]="{ 'animate-spin': isSaving }"
              ></ng-icon>
              <span>
                {{
                  isSaving
                    ? ("APP.PROFILE-PAGE.EDIT.SAVING" | translate)
                    : isEditMode
                    ? ("APP.PROFILE-PAGE.EDIT.CANCEL" | translate)
                    : ("APP.PROFILE-PAGE.EDIT.EDIT" | translate)
                }}
              </span>
            </button>
          </div>

          <!-- User Info Tab -->
          <ng-container
            *ngIf="tabs[selectedTabIndex]?.component === 'user-info'"
          >
            <div class="inline-block w-full mx-auto gap-y-4 px-2 sm:px-0">
              <!-- Profile Picture and Name -->
              <div class="flex flex-col items-center justify-center mb-4">
                <div class="relative mb-2">
                  <img
                    [src]="
                      localProfilePhotoPreview ||
                      profileUser.profilePhoto?.sourceUrl ||
                      'assets/placeholder.jpg'
                    "
                    [alt]="
                      profileUser.shelter
                        ? profileUser.shelter.shelterName
                        : profileUser.fullName
                    "
                    class="w-28 h-28 md:w-36 md:h-36 rounded-full object-cover border-4 border-primary-400 shadow-xl"
                  />
                  <div
                    *ngIf="profileUser.isVerified"
                    class="absolute -top-2 -right-2 bg-blue-500 text-white rounded-full p-1"
                  >
                    <span
                      class="inline-flex items-center justify-center w-7 h-7 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 shadow-md border-2 border-white ring-2 ring-primary-300 animate-pulse-slow"
                      matTooltip="Verified Account"
                    >
                      <ng-icon
                        name="lucideCheck"
                        class="w-5 h-5 text-white"
                        aria-label="Verified"
                      ></ng-icon>
                    </span>
                  </div>
                  <!-- Edit Profile Photo Button - positioned at bottom center -->
                  <button
                    *ngIf="isEditMode"
                    class="absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 bg-primary-600 text-white rounded-full p-2 shadow-lg hover:bg-primary-700 transition-colors border-2 border-white"
                    (click)="openProfilePhotoDialog()"
                  >
                    <ng-icon name="lucideCamera" class="w-4 h-4"></ng-icon>
                  </button>
                </div>
                <h2
                  class="text-3xl md:text-4xl font-bold gradient-text mb-2 text-center"
                >
                  {{
                    profileUser.shelter
                      ? profileUser.shelter.shelterName
                      : profileUser.fullName
                  }}
                </h2>
              </div>

              <!-- Edit Mode Form -->
              <form
                *ngIf="isEditMode && editForm"
                [formGroup]="editForm"
                (ngSubmit)="saveChanges()"
                class="w-full"
              >
                <mat-card
                  class="mb-4 mt-0 p-4 sm:p-6 rounded-xl shadow-lg bg-white/80 w-full mx-auto"
                >
                  <mat-card-content>
                    <div
                      class="flex flex-col items-center justify-center gap-6 w-full text-center"
                    >
                      <div class="flex flex-col items-center gap-4 w-full">
                        <div class="mt-2 w-full max-w-2xl mx-auto">
                          <!-- Shelter Information Section (if user is shelter) -->
                          <div
                            *ngIf="
                              profileUser.roles?.includes(UserRole.Shelter)
                            "
                            class="mb-6"
                            formGroupName="shelter"
                          >
                            <!-- Shelter Info Header -->
                            <div class="flex items-center gap-2 mb-6">
                              <ng-icon
                                name="lucideBuilding"
                                class="w-6 h-6 text-primary-500"
                                aria-label="Shelter Information"
                              ></ng-icon>
                              <h3 class="text-2xl font-bold text-primary-700">
                                {{ "APP.PROFILE-PAGE.SHELTER_INFO.TITLE" | translate }}
                              </h3>
                            </div>

                            <!-- Shelter Name -->
                            <div class="mb-4">
                              <label
                                class="block text-sm font-medium text-gray-700 mb-1"
                              >
                                {{
                                  "APP.PROFILE-PAGE.SHELTER_INFO.SHELTER_NAME"
                                    | translate
                                }}
                              </label>
                              <input
                                type="text"
                                formControlName="shelterName"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                                [class.border-red-500]="
                                  editForm.get('shelter.shelterName')
                                    ?.invalid &&
                                  editForm.get('shelter.shelterName')?.touched
                                "
                                [placeholder]="
                                  'APP.PROFILE-PAGE.EDIT.SHELTER_NAME_PLACEHOLDER'
                                    | translate
                                "
                              />
                              <div
                                *ngIf="
                                  editForm.get('shelter.shelterName')
                                    ?.invalid &&
                                  editForm.get('shelter.shelterName')?.touched
                                "
                                class="text-red-500 text-sm mt-1"
                              >
                                <span
                                  *ngIf="editForm.get('shelter.shelterName')?.errors?.['required']"
                                  >{{
                                    "APP.PROFILE-PAGE.EDIT.ERRORS.SHELTER_NAME_REQUIRED"
                                      | translate
                                  }}</span
                                >
                                <span
                                  *ngIf="editForm.get('shelter.shelterName')?.errors?.['minlength']"
                                  >{{
                                    "APP.PROFILE-PAGE.EDIT.ERRORS.SHELTER_NAME_MINLENGTH"
                                      | translate
                                  }}</span
                                >
                              </div>
                            </div>

                            <!-- Description -->
                            <div class="mb-4">
                              <label
                                class="block text-sm font-medium text-gray-700 mb-1"
                              >
                                {{
                                  "APP.PROFILE-PAGE.SHELTER_INFO.DESCRIPTION"
                                    | translate
                                }}
                              </label>
                              <textarea
                                formControlName="description"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none"
                                [class.border-red-500]="
                                  editForm.get('shelter.description')
                                    ?.invalid &&
                                  editForm.get('shelter.description')?.touched
                                "
                                rows="3"
                                [placeholder]="
                                  'APP.PROFILE-PAGE.EDIT.DESCRIPTION_PLACEHOLDER'
                                    | translate
                                "
                              ></textarea>
                              <div
                                *ngIf="
                                  editForm.get('shelter.description')
                                    ?.invalid &&
                                  editForm.get('shelter.description')?.touched
                                "
                                class="text-red-500 text-sm mt-1"
                              >
                                <span
                                  *ngIf="editForm.get('shelter.description')?.errors?.['required']"
                                  >{{
                                    "APP.PROFILE-PAGE.EDIT.ERRORS.DESCRIPTION_REQUIRED"
                                      | translate
                                  }}</span
                                >
                                <span
                                  *ngIf="editForm.get('shelter.description')?.errors?.['minlength']"
                                  >{{
                                    "APP.PROFILE-PAGE.EDIT.ERRORS.DESCRIPTION_MINLENGTH"
                                      | translate
                                  }}</span
                                >
                              </div>
                            </div>

                            <!-- Social Links -->
                            <div class="mb-4 space-y-3">
                              <div>
                                <label
                                  class="block text-sm font-medium text-gray-700 mb-1"
                                  >{{ "APP.ADOPT.WEBSITE" | translate }}</label
                                >
                                <input
                                  type="url"
                                  formControlName="website"
                                  class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                                  [class.border-red-500]="
                                    editForm.get('shelter.website')?.invalid &&
                                    editForm.get('shelter.website')?.touched
                                  "
                                  [placeholder]="
                                    'APP.PROFILE-PAGE.EDIT.WEBSITE_PLACEHOLDER'
                                      | translate
                                  "
                                />
                                <div
                                  *ngIf="
                                    editForm.get('shelter.website')?.invalid &&
                                    editForm.get('shelter.website')?.touched
                                  "
                                  class="text-red-500 text-sm mt-1"
                                >
                                  <span
                                    *ngIf="editForm.get('shelter.website')?.errors?.['pattern']"
                                    >{{
                                      "APP.PROFILE-PAGE.EDIT.ERRORS.WEBSITE_INVALID"
                                        | translate
                                    }}</span
                                  >
                                </div>
                              </div>
                              <div formGroupName="socialMedia">
                                <div>
                                  <label
                                    class="block text-sm font-medium text-gray-700 mb-1"
                                    >Facebook</label
                                  >
                                  <input
                                    type="url"
                                    formControlName="facebook"
                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                                    [class.border-red-500]="
                                      editForm.get(
                                        'shelter.socialMedia.facebook'
                                      )?.invalid &&
                                      editForm.get(
                                        'shelter.socialMedia.facebook'
                                      )?.touched
                                    "
                                    [placeholder]="
                                      'APP.PROFILE-PAGE.EDIT.FACEBOOK_PLACEHOLDER'
                                        | translate
                                    "
                                  />
                                  <div
                                    *ngIf="
                                      editForm.get(
                                        'shelter.socialMedia.facebook'
                                      )?.invalid &&
                                      editForm.get(
                                        'shelter.socialMedia.facebook'
                                      )?.touched
                                    "
                                    class="text-red-500 text-sm mt-1"
                                  >
                                    <span
                                      *ngIf="editForm.get('shelter.socialMedia.facebook')?.errors?.['invalidSocialMedia']"
                                      >{{
                                        "APP.PROFILE-PAGE.EDIT.ERRORS.FACEBOOK_INVALID"
                                          | translate
                                      }}</span
                                    >
                                  </div>
                                </div>
                                <div class="mt-3">
                                  <label
                                    class="block text-sm font-medium text-gray-700 mb-1"
                                    >Instagram</label
                                  >
                                  <input
                                    type="url"
                                    formControlName="instagram"
                                    class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                                    [class.border-red-500]="
                                      editForm.get(
                                        'shelter.socialMedia.instagram'
                                      )?.invalid &&
                                      editForm.get(
                                        'shelter.socialMedia.instagram'
                                      )?.touched
                                    "
                                    [placeholder]="
                                      'APP.PROFILE-PAGE.EDIT.INSTAGRAM_PLACEHOLDER'
                                        | translate
                                    "
                                  />
                                  <div
                                    *ngIf="
                                      editForm.get(
                                        'shelter.socialMedia.instagram'
                                      )?.invalid &&
                                      editForm.get(
                                        'shelter.socialMedia.instagram'
                                      )?.touched
                                    "
                                    class="text-red-500 text-sm mt-1"
                                  >
                                    <span
                                      *ngIf="editForm.get('shelter.socialMedia.instagram')?.errors?.['invalidSocialMedia']"
                                      >{{
                                        "APP.PROFILE-PAGE.EDIT.ERRORS.INSTAGRAM_INVALID"
                                          | translate
                                      }}</span
                                    >
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Operating Hours - Edit Mode -->
                      <div
                        *ngIf="profileUser.roles?.includes(UserRole.Shelter)"
                        class="mt-6 w-full max-w-xl mx-auto"
                        formGroupName="shelter"
                      >
                        <div
                          class="flex items-center justify-center gap-2 mb-2"
                        >
                          <ng-icon
                            name="lucideClock"
                            class="w-5 h-5 text-primary-500"
                            aria-label="Operating hours"
                          ></ng-icon>
                          <span class="font-medium text-gray-900">{{
                            "APP.ADOPT.OPERATING_HOURS" | translate
                          }}</span>
                        </div>

                        <div formGroupName="operatingHours" class="space-y-4">
                          <ng-container *ngFor="let day of days">
                            <div
                              class="mb-4 border border-gray-300 rounded-xl p-4 hover:border-gray-400 transition-colors"
                            >
                              <div
                                class="flex justify-between items-center mb-3"
                              >
                                <h4 class="text-gray-900 font-medium">
                                  {{ day }}
                                </h4>

                                <!-- Closed toggle -->
                                <div class="flex items-center">
                                  <label
                                    class="relative inline-flex items-center cursor-pointer"
                                  >
                                    <input
                                      type="checkbox"
                                      [(ngModel)]="closedDays[day]"
                                      [ngModelOptions]="{ standalone: true }"
                                      (change)="onClosedChange(day)"
                                      class="sr-only peer"
                                    />
                                    <div
                                      class="w-11 h-6 bg-gray-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"
                                    ></div>
                                  </label>
                                  <span class="ml-3 text-sm text-gray-600">{{
                                    closedDays[day]
                                      ? ("APP.AUTH.SIGNUP.SHELTER_INFO.CLOSED"
                                        | translate)
                                      : ("APP.AUTH.SIGNUP.SHELTER_INFO.OPEN"
                                        | translate)
                                  }}</span>
                                </div>
                              </div>

                              <!-- Time selection (shown only when not closed) -->
                              <div
                                *ngIf="!closedDays[day]"
                                class="flex items-center justify-between"
                              >
                                <div class="flex-1 mr-4">
                                  <label
                                    class="block text-sm text-gray-600 mb-1"
                                  >
                                    {{
                                      "APP.AUTH.SIGNUP.SHELTER_INFO.OPEN_LABEL"
                                        | translate
                                    }}
                                  </label>
                                  <input
                                    type="text"
                                    [value]="openTimes[day]"
                                    (input)="onTimeInput($event, day, 'open')"
                                    (blur)="formatTime(day, 'open')"
                                    class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"
                                    placeholder="HH:MM"
                                    pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]"
                                  />
                                </div>

                                <span
                                  class="text-gray-600 mx-2 self-end mb-3"
                                  >{{
                                    "APP.AUTH.SIGNUP.SHELTER_INFO.TO"
                                      | translate
                                  }}</span
                                >

                                <div class="flex-1 ml-4">
                                  <label
                                    class="block text-sm text-gray-600 mb-1"
                                  >
                                    {{
                                      "APP.AUTH.SIGNUP.SHELTER_INFO.CLOSE_LABEL"
                                        | translate
                                    }}
                                  </label>
                                  <input
                                    type="text"
                                    [value]="closeTimes[day]"
                                    (input)="onTimeInput($event, day, 'close')"
                                    (blur)="formatTime(day, 'close')"
                                    class="w-full px-3 py-2 bg-white border border-gray-300 rounded-lg text-gray-900 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 focus:outline-none"
                                    placeholder="HH:MM"
                                    pattern="([01]?[0-9]|2[0-3]):[0-5][0-9]"
                                  />
                                </div>
                              </div>

                              <!-- Error message -->
                              <div
                                *ngIf="timeErrors[day]"
                                class="text-red-500 text-sm mt-2"
                              >
                                {{ timeErrors[day]! | translate }}
                              </div>
                            </div>
                          </ng-container>
                        </div>
                      </div>

                      <!-- Styled Separator Under Shelter Information in Edit Mode -->
                      <div 
                        *ngIf="profileUser.roles?.includes(UserRole.Shelter)"
                        class="flex items-center justify-center my-8"
                      >
                        <div
                          class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                        ></div>
                        <span
                          class="mx-6 flex items-center justify-center bg-white rounded-full border-4 border-purple-500 shadow-lg p-2"
                        >
                          <ng-icon
                            name="lucideHouse"
                            class="w-8 h-8 text-purple-500"
                          ></ng-icon>
                        </span>
                        <div
                          class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                        ></div>
                      </div>

                      <!-- Styled Separator Before Personal Information in Edit Mode -->
                      <div 
                        class="flex items-center justify-center my-8"
                      >
                        <div
                          class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                        ></div>
                        <span
                          class="mx-6 flex items-center justify-center bg-white rounded-full border-4 border-purple-500 shadow-lg p-2"
                        >
                          <ng-icon
                            name="lucideUser"
                            class="w-8 h-8 text-purple-500"
                          ></ng-icon>
                        </span>
                        <div
                          class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                        ></div>
                      </div>

                      <!-- Personal Information Section Header in Edit Mode -->
                      <div class="flex items-center gap-2 mb-6">
                        <ng-icon
                          name="lucideUser"
                          class="w-6 h-6 text-primary-500"
                          aria-label="Personal Information"
                        ></ng-icon>
                        <h3 class="text-2xl font-bold text-primary-700">
                          {{ "APP.PROFILE-PAGE.PERSONAL_INFO.TITLE" | translate }}
                        </h3>
                      </div>

                      <!-- Personal Information Display in Edit Mode -->
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full mb-8">
                        <!-- User Info -->
                        <div class="flex flex-col gap-4">
                          <div class="flex items-center gap-3">
                            <ng-icon
                              name="lucideUser"
                              class="w-5 h-5 text-primary-500 flex-shrink-0"
                              aria-label="Full Name"
                            ></ng-icon>
                            <div>
                              <div class="text-xs font-medium text-gray-500">
                                {{
                                  "APP.PROFILE-PAGE.PERSONAL_INFO.FULL_NAME"
                                    | translate
                                }}
                              </div>
                              <div class="text-lg font-semibold text-gray-900">
                                {{ profileUser.fullName }}
                              </div>
                            </div>
                          </div>
                          <div class="flex items-center gap-3">
                            <ng-icon
                              name="lucideMail"
                              class="w-5 h-5 text-primary-500 flex-shrink-0"
                              aria-label="Email"
                            ></ng-icon>
                            <div>
                              <div class="text-xs font-medium text-gray-500">
                                {{
                                  "APP.PROFILE-PAGE.PERSONAL_INFO.EMAIL"
                                    | translate
                                }}
                              </div>
                              <div class="text-lg font-semibold text-gray-900">
                                {{ profileUser.email }}
                              </div>
                            </div>
                          </div>
                          <div
                            *ngIf="profileUser.phone"
                            class="flex items-center gap-3"
                          >
                            <ng-icon
                              name="lucidePhone"
                              class="w-5 h-5 text-primary-500 flex-shrink-0"
                              aria-label="Phone"
                            ></ng-icon>
                            <div>
                              <div class="text-xs font-medium text-gray-500">
                                {{
                                  "APP.PROFILE-PAGE.PERSONAL_INFO.PHONE"
                                    | translate
                                }}
                              </div>
                              <div class="text-lg font-semibold text-gray-900">
                                {{ profileUser.phone }}
                              </div>
                            </div>
                          </div>
                        </div>

                        <!-- Location Info -->
                        <div
                          *ngIf="profileUser.location"
                          class="flex flex-col gap-2"
                        >
                          <div class="flex items-center gap-3">
                            <ng-icon
                              name="lucideMapPin"
                              class="w-5 h-5 text-primary-500 flex-shrink-0"
                              aria-label="Location"
                            ></ng-icon>
                            <div class="flex flex-col">
                              <div class="text-xs font-medium text-gray-500">
                                {{
                                  "APP.PROFILE-PAGE.PERSONAL_INFO.LOCATION"
                                    | translate
                                }}
                              </div>
                              <a
                                [href]="getGoogleMapsLink(profileUser.location)"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="text-lg font-semibold text-primary-700 underline hover:text-primary-500 transition-colors"
                                aria-label="Open location in Google Maps"
                              >
                                {{ profileUser.location.address
                                }}{{
                                  profileUser.location.number
                                    ? " " + profileUser.location.number
                                    : ""
                                }}, {{ profileUser.location.city
                                }}{{
                                  profileUser.location.zipCode
                                    ? " " + profileUser.location.zipCode
                                    : ""
                                }}
                              </a>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Save/Cancel Buttons -->
                      <div class="mt-6 flex justify-center gap-3">
                        <button
                          type="button"
                          (click)="cancelEdit()"
                          [disabled]="isSaving"
                          class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors disabled:opacity-50"
                        >
                          {{ "APP.PROFILE-PAGE.EDIT.CANCEL" | translate }}
                        </button>
                        <button
                          type="submit"
                          [disabled]="isSaving || !editForm?.valid"
                          class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 flex items-center gap-2"
                        >
                          <ng-icon
                            [name]="isSaving ? 'lucideLoader' : 'lucideCheck'"
                            class="w-4 h-4"
                            [ngClass]="{ 'animate-spin': isSaving }"
                          ></ng-icon>
                          {{
                            isSaving
                              ? ("APP.PROFILE-PAGE.EDIT.SAVING" | translate)
                              : ("APP.PROFILE-PAGE.EDIT.SAVE" | translate)
                          }}
                        </button>
                      </div>
                    </div>
                  </mat-card-content>
                </mat-card>
              </form>

              <!-- View Mode Display -->
              
              <!-- Shelter Information Card - Only for Shelter Users -->
              <mat-card
                *ngIf="!isEditMode && profileUser.roles?.includes(UserRole.Shelter)"
                class="mb-6 mt-0 p-4 sm:p-6 rounded-xl shadow-lg bg-white/80 w-full mx-auto"
              >
              <!-- Styled Separator Under Shelter Information -->
              <div 
                *ngIf="!isEditMode && profileUser.roles?.includes(UserRole.Shelter)"
                class="flex items-center justify-center my-8"
              >
                <div
                  class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                ></div>
                <span
                  class="mx-6 flex items-center justify-center bg-white rounded-full border-4 border-purple-500 shadow-lg p-2"
                >
                  <ng-icon
                    name="lucideHouse"
                    class="w-8 h-8 text-purple-500"
                  ></ng-icon>
                </span>
                <div
                  class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                ></div>
              </div>
                <mat-card-content>
                  <!-- Shelter Info Header -->
                  <div class="flex items-center gap-2 mb-6">
                    <ng-icon
                      name="lucideBuilding"
                      class="w-6 h-6 text-primary-500"
                      aria-label="Shelter Information"
                    ></ng-icon>
                    <h3 class="text-2xl font-bold text-primary-700">
                      {{ "APP.PROFILE-PAGE.SHELTER_INFO.TITLE" | translate }}
                    </h3>
                  </div>
                  
                  <div
                    class="flex flex-col items-center justify-center gap-6 w-full text-center"
                  >
                    <div class="flex flex-col items-center gap-4 w-full">
                      <div class="mt-2">
                        <div class="text-xl font-semibold text-gray-900 mt-1">
                          {{ profileUser.shelter?.shelterName }}
                        </div>

                        <!-- Description - View Mode -->
                        <div
                          class="text-xs sm:text-sm text-gray-500 mt-1 break-words whitespace-pre-line max-w-xs sm:max-w-lg md:max-w-xl lg:max-w-2xl w-full mx-auto text-center overflow-hidden overflow-ellipsis px-2 sm:px-4"
                        >
                          {{ profileUser.shelter?.description }}
                        </div>
                      </div>

                      <!-- Social Links - View Mode -->
                      <div
                        class="flex flex-wrap justify-center gap-2 items-center mt-2"
                      >
                        <a
                          *ngIf="profileUser.shelter?.website"
                          [href]="profileUser.shelter?.website"
                          target="_blank"
                          rel="noopener"
                          class="flex items-center gap-2 text-primary-600 hover:underline"
                        >
                          <ng-icon
                            name="lucideGlobe"
                            class="w-5 h-5"
                            aria-label="Website"
                          ></ng-icon>
                          <span>{{ "APP.ADOPT.WEBSITE" | translate }}</span>
                        </a>
                        <a
                          *ngIf="profileUser.shelter?.socialMedia?.facebook"
                          [href]="profileUser.shelter?.socialMedia?.facebook"
                          target="_blank"
                          rel="noopener"
                          class="flex items-center gap-2 text-blue-600 hover:underline"
                        >
                          <ng-icon
                            name="lucideFacebook"
                            class="w-5 h-5"
                            aria-label="Facebook"
                          ></ng-icon>
                          <span>Facebook</span>
                        </a>
                        <a
                          *ngIf="profileUser.shelter?.socialMedia?.instagram"
                          [href]="profileUser.shelter?.socialMedia?.instagram"
                          target="_blank"
                          rel="noopener"
                          class="flex items-center gap-2 text-pink-500 hover:underline"
                        >
                          <ng-icon
                            name="lucideInstagram"
                            class="w-5 h-5"
                            aria-label="Instagram"
                          ></ng-icon>
                          <span>Instagram</span>
                        </a>
                      </div>
                    </div>

                    <!-- Operating Hours - View Mode -->
                    <div class="mt-6 w-full max-w-xl mx-auto">
                      <div class="flex items-center justify-center gap-2 mb-2">
                        <ng-icon
                          name="lucideClock"
                          class="w-5 h-5 text-primary-500"
                          aria-label="Operating hours"
                        ></ng-icon>
                        <span class="font-medium text-gray-900">{{
                          "APP.ADOPT.OPERATING_HOURS" | translate
                        }}</span>
                      </div>

                      <div
                        class="grid grid-cols-1 sm:grid-cols-2 gap-1 sm:gap-2"
                      >
                        <ng-container
                          *ngFor="
                            let day of [
                              'monday',
                              'tuesday',
                              'wednesday',
                              'thursday',
                              'friday',
                              'saturday',
                              'sunday'
                            ]
                          "
                        >
                          <div
                            class="px-3 py-2 bg-white/60 rounded-lg flex justify-between items-center text-sm sm:text-base w-auto min-w-fit max-w-full whitespace-nowrap shadow-sm border border-primary-100"
                          >
                            <span class="capitalize text-gray-700">{{
                              "APP.ADOPT.DAYS." + day.toUpperCase() | translate
                            }}</span>
                            <span class="text-gray-700 ml-4">{{
                              getOperatingHourByDay(
                                profileUser.shelter?.operatingHours,
                                day
                              )
                            }}</span>
                          </div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>


              <!-- Styled Separator Before Personal Information -->
              <div 
                class="flex items-center justify-center my-8"
              >
                <div
                  class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                ></div>
                <span
                  class="mx-6 flex items-center justify-center bg-white rounded-full border-4 border-purple-500 shadow-lg p-2"
                >
                  <ng-icon
                    name="lucideUser"
                    class="w-8 h-8 text-purple-500"
                  ></ng-icon>
                </span>
                <div
                  class="w-full max-w-sm border-t-4 border-purple-500 opacity-80"
                ></div>
              </div>

              <!-- Personal Info Card - Always Visible -->
              <mat-card
                class="mb-4 p-3 sm:p-4 rounded-xl shadow-lg bg-white/80 w-full mx-auto"
              >
                <mat-card-content>
                  <div class="space-y-6">
                    <!-- Personal Info Header -->
                    <div class="flex items-center gap-2 mb-6">
                      <ng-icon
                        name="lucideUser"
                        class="w-6 h-6 text-primary-500"
                        aria-label="Personal Information"
                      ></ng-icon>
                      <h3 class="text-2xl font-bold text-primary-700">
                        {{ "APP.PROFILE-PAGE.PERSONAL_INFO.TITLE" | translate }}
                      </h3>
                    </div>

                    <!-- Personal Info - Always Visible -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
                      <!-- User Info -->
                      <div class="flex flex-col gap-4">
                        <div class="flex items-center gap-3">
                          <ng-icon
                            name="lucideUser"
                            class="w-5 h-5 text-primary-500 flex-shrink-0"
                            aria-label="Full Name"
                          ></ng-icon>
                          <div>
                            <div class="text-xs font-medium text-gray-500">
                              {{
                                "APP.PROFILE-PAGE.PERSONAL_INFO.FULL_NAME"
                                  | translate
                              }}
                            </div>
                            <div class="text-lg font-semibold text-gray-900">
                              {{ profileUser.fullName }}
                            </div>
                          </div>
                        </div>
                        <div class="flex items-center gap-3">
                          <ng-icon
                            name="lucideMail"
                            class="w-5 h-5 text-primary-500 flex-shrink-0"
                            aria-label="Email"
                          ></ng-icon>
                          <div>
                            <div class="text-xs font-medium text-gray-500">
                              {{
                                "APP.PROFILE-PAGE.PERSONAL_INFO.EMAIL"
                                  | translate
                              }}
                            </div>
                            <div class="text-lg font-semibold text-gray-900">
                              {{ profileUser.email }}
                            </div>
                          </div>
                        </div>
                        <div
                          *ngIf="profileUser.phone"
                          class="flex items-center gap-3"
                        >
                          <ng-icon
                            name="lucidePhone"
                            class="w-5 h-5 text-primary-500 flex-shrink-0"
                            aria-label="Phone"
                          ></ng-icon>
                          <div>
                            <div class="text-xs font-medium text-gray-500">
                              {{
                                "APP.PROFILE-PAGE.PERSONAL_INFO.PHONE"
                                  | translate
                              }}
                            </div>
                            <div class="text-lg font-semibold text-gray-900">
                              {{ profileUser.phone }}
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Location Info -->
                      <div
                        *ngIf="profileUser.location"
                        class="flex flex-col gap-2"
                      >
                        <div class="flex items-center gap-3">
                          <ng-icon
                            name="lucideMapPin"
                            class="w-5 h-5 text-primary-500 flex-shrink-0"
                            aria-label="Location"
                          ></ng-icon>
                          <div class="flex flex-col">
                            <div class="text-xs font-medium text-gray-500">
                              {{
                                "APP.PROFILE-PAGE.PERSONAL_INFO.LOCATION"
                                  | translate
                              }}
                            </div>
                            <a
                              [href]="getGoogleMapsLink(profileUser.location)"
                              target="_blank"
                              rel="noopener noreferrer"
                              class="text-lg font-semibold text-primary-700 underline hover:text-primary-500 transition-colors"
                              aria-label="Open location in Google Maps"
                            >
                              {{ profileUser.location.address
                              }}{{
                                profileUser.location.number
                                  ? " " + profileUser.location.number
                                  : ""
                              }}, {{ profileUser.location.city
                              }}{{
                                profileUser.location.zipCode
                                  ? " " + profileUser.location.zipCode
                                  : ""
                              }}
                            </a>
                          </div>
                          <button
                            type="button"
                            (click)="togglePersonalMap()"
                            class="ml-2 flex items-center justify-center p-2 rounded-md bg-gradient-to-r from-primary-100 to-accent-100 text-primary-700 shadow hover:from-primary-200 hover:to-accent-200 focus:outline-none focus:ring-2 focus:ring-primary-400 transition w-8 h-8 min-w-0"
                            aria-label="Show/hide map"
                          >
                            <ng-icon
                              *ngIf="!showPersonalMap"
                              name="lucideMapPinXInside"
                              class="w-5 h-5"
                              aria-hidden="true"
                            ></ng-icon>
                            <ng-icon
                              *ngIf="showPersonalMap"
                              name="lucideEyeOff"
                              class="w-5 h-5"
                              aria-hidden="true"
                            ></ng-icon>
                          </button>
                        </div>
                        <div class="mt-2 flex justify-center w-full">
                          <iframe
                            *ngIf="personalMapUrl && showPersonalMap"
                            [src]="personalMapUrl"
                            width="100%"
                            height="220"
                            class="rounded-lg border border-primary-200 shadow w-full max-w-md"
                            allowfullscreen=""
                            loading="lazy"
                            referrerpolicy="no-referrer-when-downgrade"
                            aria-label="Google Maps location"
                          ></iframe>
                        </div>
                      </div>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </ng-container>

          <!-- Other Tabs -->
          <ng-container
            *ngIf="
              tabs[selectedTabIndex]?.component === 'adoption-applications'
            "
          >
            <div class="-mx-6 -my-6 p-0 h-full flex flex-col">
              <app-profile-adoption-applications
                tabType="adoption-applications"
                (viewDetails)="onViewApplication($event)"
                class="flex-1 h-full"
              ></app-profile-adoption-applications>
            </div>
          </ng-container>

          <ng-container
            *ngIf="tabs[selectedTabIndex]?.component === 'my-animals'"
          >
            <app-profile-animals
              [shelterId]="
                profileUser && profileUser.shelter
                  ? profileUser.shelter.id ?? null
                  : null
              "
            ></app-profile-animals>
          </ng-container>

          <ng-container
            *ngIf="
              tabs[selectedTabIndex]?.component === 'received-applications'
            "
          >
            <div class="-mx-6 -my-6 p-0 h-full flex flex-col">
              <app-profile-adoption-applications
                tabType="received-applications"
                (viewDetails)="onViewApplication($event)"
                class="flex-1 h-full"
              ></app-profile-adoption-applications>
            </div>
          </ng-container>
        </section>

        <section
          *ngIf="tabs.length === 0"
          class="flex-1 flex flex-col items-center justify-center min-h-[300px] text-center text-gray-500"
        >
          <ng-icon
            name="lucideAlertCircle"
            class="w-16 h-16 mb-4 text-primary-400"
            aria-label="No profile data"
          ></ng-icon>
          <div class="text-lg font-semibold mb-2">
            {{ "APP.PROFILE-PAGE.NO_PROFILE_TABS" | translate }}
          </div>
          <div class="text-base">
            {{ "APP.PROFILE-PAGE.NO_PROFILE_TABS_SUBTEXT" | translate }}
          </div>
        </section>
      </div>
    </div>
  </main>
</div>
